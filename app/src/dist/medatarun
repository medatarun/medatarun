#!/bin/sh

jvm_opts=""
app_args=""

for arg in "$@"; do
  case "$arg" in
    -D*|-X*|-XX:*)
      jvm_opts="$jvm_opts $arg"
      ;;
    *)
      app_args="$app_args \"$arg\""
      ;;
  esac
done

APP_OPTS="$APP_OPTS $jvm_opts"
export APP_OPTS

CURRENT_DIRECTORY=$(dirname "$0")

# Use the packaged Logback config when running from the distribution.
LOGBACK_CONFIG="$CURRENT_DIRECTORY/config/logback.xml"
if [ -f "$LOGBACK_CONFIG" ]; then
  APP_OPTS="$APP_OPTS -Dlogback.configurationFile=$LOGBACK_CONFIG"
  export APP_OPTS
fi

# Define MEDATARUN_HOME to the current directory if it has not been defined before
if [ -z "${MEDATARUN_HOME+x}" ]; then
  MEDATARUN_HOME=$CURRENT_DIRECTORY
fi
export MEDATARUN_HOME

# Define MEDATARUN_APPLICATION_DATA to data/ directory if it has not been defined before
if [ -z "${MEDATARUN_APPLICATION_DATA+x}" ]; then
  MEDATARUN_APPLICATION_DATA=$CURRENT_DIRECTORY/data;
  mkdir -p $MEDATARUN_APPLICATION_DATA
fi
export MEDATARUN_APPLICATION_DATA

# Use eval to preserve quoted app arguments when forwarding to the Gradle script.
eval "exec \"$CURRENT_DIRECTORY/bin/app\" $app_args"
